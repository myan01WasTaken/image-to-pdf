<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Images to PDF</title>

  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      padding: 16px;
    }
    button {
      padding: 10px 14px;
      margin: 6px 0;
      width: 100%;
      font-size: 16px;
    }
  </style>
</head>
<body>

  <h2>Images â†’ PDF</h2>

  <input type="file" multiple accept="image/*" id="picker">

  <button id="makePdf">Make PDF</button>
  <button id="makeA4Pdf">Make A4 PDF (No Crop)</button>
  <button id="printPdf" disabled>Print PDF</button>

  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

  <script>
    const picker = document.getElementById("picker");
    const printBtn = document.getElementById("printPdf");

    let lastPdfBlob = null;

    async function createPdf(useA4) {
      const pdf = await PDFLib.PDFDocument.create();

      // A4 size in points (72 DPI)
      const A4_WIDTH = 595.28;
      const A4_HEIGHT = 841.89;

      for (const file of picker.files) {
        const bytes = await file.arrayBuffer();
        const img = file.type.includes("png")
          ? await pdf.embedPng(bytes)
          : await pdf.embedJpg(bytes);

        let pageWidth = img.width;
        let pageHeight = img.height;

        if (useA4) {
          pageWidth = A4_WIDTH;
          pageHeight = A4_HEIGHT;
        }

        const page = pdf.addPage([pageWidth, pageHeight]);

        let scale = 1;
        if (useA4) {
          scale = Math.min(
            A4_WIDTH / img.width,
            A4_HEIGHT / img.height
          );
        }

        const drawWidth = img.width * scale;
        const drawHeight = img.height * scale;

        const x = (pageWidth - drawWidth) / 2;
        const y = (pageHeight - drawHeight) / 2;

        page.drawImage(img, {
          x,
          y,
          width: drawWidth,
          height: drawHeight
        });
      }

      const pdfBytes = await pdf.save();
      lastPdfBlob = new Blob([pdfBytes], { type: "application/pdf" });

      const url = URL.createObjectURL(lastPdfBlob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "images.pdf";
      a.click();

      printBtn.disabled = false;
    }

    document.getElementById("makePdf").onclick = () => {
      createPdf(false);
    };

    document.getElementById("makeA4Pdf").onclick = () => {
      createPdf(true);
    };

    document.getElementById("printPdf").onclick = () => {
      if (!lastPdfBlob) return;

      const url = URL.createObjectURL(lastPdfBlob);
      const iframe = document.createElement("iframe");
      iframe.style.display = "none";
      iframe.src = url;

      document.body.appendChild(iframe);

      iframe.onload = () => {
        iframe.contentWindow.print();
      };
    };
  </script>

</body>
</html>
